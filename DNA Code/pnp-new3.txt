##get LID from hostname variable
#set( $LID = $hostname.substring(0,4) )
!
##set the variables so they wont appear in the list of the GUI variables as these are used only inside of the template scripts.
#set($vlans = [])
!
##------ Nonessential services----
!
no service pad
no service udp-small-servers
no service tcp-small-servers
no ip finger					   
no ip bootp server
no platform punt-keepalive disable-kernel-core
no ip source-route
no ip http server
no ip http secure-server
!
## access switch specific
no service dhcp
!
##------ Active services----
!
service tcp-keepalives-in
service tcp-keepalives-out
service timestamps debug datetime msec show-timezone
service timestamps log datetime msec show-timezone
service password-encryption
!
cdp run
lldp run
!
##------ Basic configuration----
!
hostname ${hostname}-PNP
!
no aaa new-model
!
## following enable/username configs are used only for PnP staging, the correct ABC Ltd enable/username passwords are defined in Day-N templates
!
enable secret C1sco12345
!
username admin secret C1sco123456
!
!ip domain-name dcloud.cisco.com
!
!no ip domain-lookup
!
ip ssh version 2
ip ssh time-out 60
ip ssh authentication-retries 3
ip ssh source-interface GigabitEthernet0/0
!
crypto key generate rsa general-keys modulus 2048 
!
errdisable recovery cause udld
errdisable recovery cause bpduguard
errdisable recovery cause channel-misconfig
errdisable recovery cause link-flap
errdisable recovery cause psecure-violation
errdisable recovery cause port-mode-failure
errdisable recovery cause dhcp-rate-limit
errdisable recovery cause mac-limit
errdisable recovery cause inline-power
!
ip ftp source-interface GigabitEthernet0/0
ip tftp source-interface GigabitEthernet0/0
!
##---------VTP-------
!
vtp mode off
!
##---------Spanning Tree Protocol and Associated Protocols -------
!
spanning-tree mode rapid-pvst
spanning-tree loopguard default
spanning-tree portfast bpduguard default
spanning-tree extend system-id
!
udld enable
!
##---------Layer2--------
!
logging host 198.18.129.100 vrf Mgmt-vrf
!
##Vlan Description
##split vlan IDs list by either comma or space, then configure all the user VLANs and other basic VLANs
!
#if($user_vlanids.toString().contains(","))
#set ($vlans = $user_vlanids.split('\,'))
#else
#set ($vlans = $user_vlanids.split('\ '))
#end
!
#foreach ($vlan in $vlans)
 !
 vlan ${vlan}
  name User_${vlan} 
 ! 
#end
!
vlan 710
 name Voice
!
vlan 999
 name NATIVE_vlan
!
vlan 805
 name WLAN-Mgmt
!
vlan 1000
 name Network-Mgmt
!
##---------Layer3--------
!
!
interface Vlan1
 shutdown
!
interface GigabitEthernet0/0
 Description |MANAGEMENT|
 ##ip address ${Network-Mgmt_IP} ${Network-Mgmt_Mask}
 vrf forwarding Mgmt-vrf
 ip address dhcp
 no ip redirects
 no ip unreachables
 no ip proxy-arp
 no shutdown
!
no ip routing
!
##ip default-gateway ${default_gateway}
!
## --------VTY Lines-----------------
!
line con 0			  
 login local
 logging synchronous
!
line vty 0 15
 login local
 transport input ssh
 logging synchronous
!
line vty 16 31
 login local
 transport input ssh
 logging synchronous
!
##-------DHCP snooping----------
!
ip dhcp snooping vlan 1-4094
ip dhcp snooping
!
!
##---------QoS--------
## Qos is here so we can apply qos to interfaces now and do not have to do it later
!
!
ip access-list extended LYNC_voice
 permit tcp any any range 39040 39059
 permit udp any any range 39040 39059
 permit tcp any range 39040 39059 any
 permit udp any range 39040 39059 any
!
ip access-list extended LYNC_video
 permit udp any any range 39060 39079
 permit tcp any any range 39060 39079
 permit udp any range 39060 39079 any
 permit tcp any range 39060 39079 any
!
ip access-list extended LYNC_signaling
  permit tcp any any eq 5061
  permit tcp any eq 5061 any 
!
ip access-list extended CAPWAP_control
  permit udp any any eq 5246
!
class-map match-any LYNC_voice
  match access-group name LYNC_voice
class-map match-any LYNC_video
  match access-group name LYNC_video
class-map match-any LYNC_signaling
  match access-group name LYNC_signaling
class-map match-any CAPWAP_control
  match access-group name CAPWAP_control
!
class-map egress_voice
 match dscp 40 46
class-map egress_video 
  match dscp CS4 af41 af42 af43
class-map egress_critical
  match dscp af31
class-map egress_preferred
  match dscp af32 af33
class-map egress_net_control_mgmt
  match dscp cs6 AF22
class-map egress_signaling
  match dscp af21
class-map egress_bulk
  match dscp cs1
!
policy-map mark_user_interface
  class LYNC_voice
    set dscp ef
    police 160000 8000  conform-action transmit exceed-action drop 
  class LYNC_video
    set dscp af41
  class LYNC_signaling
    set dscp af21
  class class-default
    set dscp default 
!
policy-map mark_AP_wireless_interface
    class CAPWAP_control
      set dscp cs6
    class LYNC_voice
      set dscp ef
      police 1600000 8000 conform-action transmit exceed-action drop
    class LYNC_video
      set dscp af41
    class LYNC_signaling
      set dscp af21
    class class-default
      set dscp default
!
policy-map egress_queue
  class egress_voice
   priority level 1
   police rate percent 10
  class egress_video
    bandwidth remaining percent 34
    queue-buffers ratio 15
    queue-limit dscp AF43 percent 80
    queue-limit dscp AF42 percent 90
    queue-limit dscp AF41 percent 100
   class egress_critical  
    bandwidth remaining percent 15
    queue-buffers ratio 10   
   class egress_preferred
    bandwidth remaining percent 8
    queue-buffers ratio 10
    queue-limit dscp AF33 percent 80
    queue-limit dscp AF32 percent 100
   class egress_net_control_mgmt
    bandwidth remaining percent 9
    queue-buffers ratio 10
    queue-limit dscp AF23 percent 80
    queue-limit dscp AF22 percent 90
    queue-limit dscp CS6 percent 100
   class egress_signaling
     bandwidth remaining percent 8
     queue-buffers ratio 10   
   class egress_bulk
     bandwidth remaining percent 1
     queue-buffers ratio 10
     queue-limit dscp AF13 percent 80
     queue-limit dscp AF12 percent 90
     queue-limit dscp AF11 percent 100
   class class-default
      bandwidth remaining percent 25
      queue-buffers ratio 25
!
policy-map mark_SBA_interface
 class LYNC_voice
  set dscp ef
 class LYNC_video
  set dscp af41
 class LYNC_signaling
  set dscp af21
 class class-default
  set dscp default
!
policy-map SBA_egress_queue
 class egress_voice
  priority level 1
  police rate percent 50
 class egress_video
  bandwidth remaining percent 5
 class egress_critical
  bandwidth remaining percent 5
 class egress_preferred
  bandwidth remaining percent 5
 class egress_net_control_mgmt
  bandwidth remaining percent 10
  queue-buffers ratio 10
 class egress_signaling
  bandwidth remaining percent 20
  queue-buffers ratio 30
 class egress_bulk
  bandwidth remaining percent 5
  queue-buffers ratio 10
 class class-default
  bandwidth remaining percent 50
  queue-buffers ratio 25
!
logging host 198.18.129.100 vrf Mgmt-vrf
!
!
snmp-server community rw RW
snmp-server enable traps snmp authentication linkdown linkup coldstart warmstart
snmp-server enable traps flowmon
snmp-server enable traps entity-perf throughput-notif
snmp-server enable traps call-home message-send-fail server-fail
snmp-server enable traps tty
snmp-server enable traps ospf state-change
snmp-server enable traps ospf errors
snmp-server enable traps ospf retransmit
snmp-server enable traps ospf lsa
snmp-server enable traps ospf cisco-specific state-change nssa-trans-change
snmp-server enable traps ospf cisco-specific state-change shamlink interface
snmp-server enable traps ospf cisco-specific state-change shamlink neighbor
snmp-server enable traps ospf cisco-specific errors
snmp-server enable traps ospf cisco-specific retransmit
snmp-server enable traps ospf cisco-specific lsa
snmp-server enable traps eigrp
snmp-server enable traps auth-framework sec-violation
snmp-server enable traps rep
snmp-server enable traps vtp
snmp-server enable traps vlancreate
snmp-server enable traps vlandelete
snmp-server enable traps port-security
snmp-server enable traps license
snmp-server enable traps smart-license
snmp-server enable traps cpu threshold
snmp-server enable traps memory bufferpeak
snmp-server enable traps stackwise
snmp-server enable traps udld link-fail-rpt
snmp-server enable traps udld status-change
snmp-server enable traps fru-ctrl
snmp-server enable traps flash insertion removal lowspace
snmp-server enable traps energywise
snmp-server enable traps power-ethernet group 1 threshold 80
snmp-server enable traps power-ethernet police
snmp-server enable traps entity
snmp-server enable traps pw vc
snmp-server enable traps mvpn
snmp-server enable traps envmon
snmp-server enable traps cef resource-failure peer-state-change peer-fib-state-change inconsistency
snmp-server enable traps lisp
snmp-server enable traps isis
snmp-server enable traps ipsla
snmp-server enable traps entity-diag boot-up-fail hm-test-recover hm-thresh-reached scheduled-test-fail
snmp-server enable traps bfd
snmp-server enable traps ike policy add
snmp-server enable traps ike policy delete
snmp-server enable traps ike tunnel start
snmp-server enable traps ike tunnel stop
snmp-server enable traps ipsec cryptomap add
snmp-server enable traps ipsec cryptomap delete
snmp-server enable traps ipsec cryptomap attach
snmp-server enable traps ipsec cryptomap detach
snmp-server enable traps ipsec tunnel start
snmp-server enable traps ipsec tunnel stop
snmp-server enable traps ipsec too-many-sas
snmp-server enable traps config-copy
snmp-server enable traps config
snmp-server enable traps config-ctid
snmp-server enable traps dhcp
snmp-server enable traps event-manager
snmp-server enable traps hsrp
snmp-server enable traps ipmulticast
snmp-server enable traps msdp
snmp-server enable traps ospfv3 state-change
snmp-server enable traps ospfv3 errors
snmp-server enable traps pim neighbor-change rp-mapping-change invalid-pim-message
snmp-server enable traps bridge newroot topologychange
snmp-server enable traps stpx inconsistency root-inconsistency loop-inconsistency
snmp-server enable traps syslog
snmp-server enable traps bgp cbgp2
snmp-server enable traps nhrp nhs
snmp-server enable traps nhrp nhc
snmp-server enable traps nhrp nhp
snmp-server enable traps nhrp quota-exceeded
snmp-server enable traps mpls rfc ldp
snmp-server enable traps mpls ldp
snmp-server enable traps mpls rfc traffic-eng
snmp-server enable traps mpls traffic-eng
snmp-server enable traps mpls fast-reroute protected
snmp-server enable traps local-auth
snmp-server enable traps vlan-membership
snmp-server enable traps errdisable
snmp-server enable traps rf
snmp-server enable traps transceiver all
snmp-server enable traps bulkstat collection transfer
snmp-server enable traps mac-notification change move threshold
snmp-server enable traps vrfmib vrf-up vrf-down vnet-trunk-up vnet-trunk-down
snmp-server enable traps mpls vpn
snmp-server enable traps mpls rfc vpn
snmp-server host 198.18.129.100 vrf Mgmt-vrf version 2c rw 
!
!